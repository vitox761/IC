<!DOCTYPE html>
<html>
<head>
<audio id = "beep01">
  <source src="sound/beep01.mp3" type="audio/mpeg">
</audio>
<audio id = "beep02">
  <source src="sound/beep02.mp3" type="audio/mpeg">
</audio>
<audio id = "beep03">
  <source src="sound/beep03.mp3" type="audio/mpeg">
</audio>
<audio id = "flip">
  <source src="sound/flip.mp3" type="audio/mpeg">
</audio>
<script type="text/javascript" src="quill/quill.js"></script>
<script>
function inicio(){
  // Criando editor rich text e vetor de cores
  editor = new Quill('#editor');
  cores = ['rgb(255,255,255)','rgb(255,255,0)'];
  coresCont = 0;


  // Cookies
  texto = "";
  indiceCookie = 1;
  var d = new Date();
  var n = new Date();
  d.setTime(d.getTime() + (30*24*60*60*1000));//30 dias
  var nomeCookie = n.toString().substring(4,11);
  nomeCookie = trim(nomeCookie);
  while (getCookie(nomeCookie+"_"+indiceCookie) != "")
  {
	indiceCookie++;
  }
  timerAutoSave = setInterval(function(){document.cookie = nomeCookie+"_"+indiceCookie+"="+texto+"; expires="+d.toUTCString();}, 5000);
  timerTesteAutoSave = setInterval(function(){alert(getAllCookies("Feb"));}, 11000);//mostra todas as informações salvas nos 30 dias do mes atual
  
  
  // Vetor para salvar combinacao
  combination = ["",""];
  indice = 0;

  // Definindo tamanho do canvas
  c = document.getElementById("myCanvas");
  c.width = window.screen.width;
  c.height= window.screen.height;
  ctx = c.getContext("2d");

  // Definindo proporção e tamanho de fonte inicial
  var font_inicial = 30;
  var font_side = font_inicial/1.4142;
  var ratio_width = c.width/font_side;
  var ratio_height = c.height/font_side;
  var ratio = Math.sqrt((ratio_width*ratio_width) + (ratio_height*ratio_height));
  var ratio = ratio/69.23;
  size_font_big = font_inicial*ratio;
  var screen_ratio = ((c.width/c.height)*0.5)/1.778;
  size_font_small = size_font_big*screen_ratio;


  // Criando vetor com todos os dados usados para desenhar o teclado + o highlight
  vetorDados = [];
  /* CE */ vetorDados[0] = { teclado:false,width1A:c.width*0.01,width2A:c.width*0.01+size_font_big,width3A:c.width*0.01,width1B:c.width*0.01+size_font_big,width2B:c.width*0.01+size_font_big+size_font_small,width3B:c.width*0.01+size_font_big,width1C:c.width*0.37,width2C:c.width*0.37+size_font_small*2.2,width3C:c.width*0.37,height1A:size_font_big ,height2A:size_font_big ,height3A:size_font_big*2,height1B:size_font_big*1.7, height2B:size_font_big*1.7,height3B:size_font_big*1.7+size_font_small,height1C:c.height*0.37+size_font_small, height2C:c.height*0.37+size_font_small,height3C:c.height*0.37+size_font_small*2,text1A:"A", text1B:"B", text1C:"C",text2A:"0", text2B:"Z",text2C:"Y",highlightW:0, highlightH:0};
  /*  E */ vetorDados[1] = { teclado:false,width1A:c.width*0.01,width2A:c.width*0.01,width3A:c.width*0.01, width1B:c.width*0.013+size_font_big,width2B:c.width*0.013+size_font_big,width3B:c.width*0.013+size_font_big, width1C:c.width*0.368,width2C:c.width*0.368,width3C:c.width*0.368, height1A:c.height*0.475 ,height2A:c.height*0.475+size_font_big ,height3A:c.height*0.475+size_font_big*2, height1B:c.height*0.475, height2B:c.height*0.475+size_font_big,height3B:c.height*0.475+size_font_big*2, height1C:c.height*0.485, height2C:c.height*0.485+size_font_small,height3C:c.height*0.485+size_font_small*2 ,text1A:'T', text1B:'U', text1C:'V',text2A:'K', text2B:'W',text2C:'X',highlightW:0, highlightH:c.height/2};
  /* BE */ vetorDados[2] = { teclado:false,width1A:c.width*0.01,width2A:c.width*0.01,width3A:9999, width1B:c.width*0.01+size_font_big,width2B:c.width*0.01+size_font_big,width3B:9999, width1C:c.width*0.387,width2C:c.width*0.387,width3C:9999, height1A:c.height*0.95,height2A:c.height*0.95+size_font_big ,height3A:9999, height1B:c.height*0.95-size_font_small, height2B:c.height*0.95,height3B:9999, height1C:c.height*0.60, height2C:c.height*0.60+size_font_small,height3C:9999 ,text1A:'Q', text1B:'S R', text1C:'',text2A:'', text2B:'',text2C:'',highlightW:0, highlightH:c.height};
  /* CD */ vetorDados[3] = { teclado:false,width1A:c.width*0.95,width2A:c.width*0.95+size_font_big*1.3,width3A:c.width*0.95+size_font_big, width1B:c.width*0.95,width2B:c.width*0.95+size_font_small,width3B:c.width*0.95+size_font_small, width1C:c.width*0.59-size_font_small,width2C:c.width*0.59+size_font_small*1.5,width3C:c.width*0.59+size_font_small, height1A:size_font_big ,height2A:size_font_big ,height3A:size_font_big*2, height1B:size_font_big*1.7, height2B:size_font_big*1.7,height3B:size_font_big*2.2, height1C:c.height*0.37+size_font_small, height2C:c.height*0.37+size_font_small,height3C:c.height*0.37+size_font_small*2 ,text1A:' G', text1B:'I', text1C:'H',text2A:'4', text2B:'5',text2C:'6',highlightW:c.width, highlightH:0};
  /* BD */ vetorDados[4] = { teclado:false,width1A:c.width*0.95+size_font_big ,width2A:c.width*0.95, width3A:0,width1B:0,width2B:0,width3B:0,width1C:c.width*0.59+size_font_small,width2C:c.width*0.59,width3C:0, height1A:c.height*0.95, height2A:c.height*0.95+size_font_big, height3A:0,height1B:0,height2B:0,height3B:0,height1C:c.height*0.60,height2C:c.height*0.60+size_font_small,height3C:c.height*0.60+size_font_small, text1A:"N", text1B:"P O", text1C:'',text2A:'', text2B:'', text2C:'', highlightW:c.width, highlightH:c.height};
  /*  D */ vetorDados[5] = { teclado:false,width1A:c.width*0.95+size_font_big ,width2A:c.width*0.95+size_font_big, width3A:c.width*0.95+size_font_big,width1B:c.width*0.933+size_font_big,width2B:c.width*0.933+size_font_big,width3B:c.width*0.933+size_font_big,width1C:c.width*0.59+size_font_small,width2C:c.width*0.59+size_font_small,width3C:c.width*0.59+size_font_small,height1A:c.height*0.475, height2A:c.height*0.475+size_font_big, height3A:c.height*0.475+size_font_big*2,height1C:c.height*0.485,height2C:c.height*0.485+size_font_small,height3C:c.height*0.485+size_font_small*2,height1B:c.height*0.475,height2B:c.height*0.475+size_font_big,height3B:c.height*0.475+size_font_big*2, text1A:" J", text1B:" L", text1C:" M",text2A:"7", text2B:"8", text2C:"9", highlightW:c.width, highlightH:c.height/2};
  /*  C */ vetorDados[6] = { teclado:false,width1A:c.width*0.50-size_font_big*1.3,width2A:c.width*0.50-size_font_big*0.3, width3A:c.width*0.50+size_font_big*0.7,width1B:c.width*0.50-size_font_small*1.3,width2B:c.width*0.50-size_font_small*0.3,width3B:c.width*0.50+size_font_small*0.7,width1C:c.width*0.46,width2C:c.width*0.46+size_font_small*2.5,width3C:c.width*0.46+size_font_small*5, height1A:size_font_big, height2A:size_font_big, height3A:size_font_big,height1B:size_font_big*1.5,height2B:size_font_big*1.5,height3B:size_font_big*1.5,height1C:c.height*0.37+size_font_small,height2C:c.height*0.37+size_font_small,height3C:c.height*0.37+size_font_small, text1A:"D", text1B:'E', text1C:'F',text2A:"1", text2B:'2', text2C:'3', highlightW:c.width/2, highlightH:0};
  /*  B */ vetorDados[7] = { teclado:false,width1A:c.width*0.50-size_font_big*4,width2A:0, width3A:0,width1B:0,width2B:0,width3B:0,width1C:c.width*0.50-size_font_small*4,width2C:0,width3C:0, height1A:c.height*0.95+size_font_big, height2A:0, height3A:0,height1B:0,height2B:0,height3B:0,height1C:c.height*0.63+size_font_small,height2C:0,height3C:0, text1A:"V D A", text1B:'', text1C:'',text2A:'', text2B:'', text2C:'', highlightW:c.width/2, highlightH:c.height};
  posicao = { CE:vetorDados[0] , E:vetorDados[1] , BE:vetorDados[2],CD:vetorDados[3],BD:vetorDados[4],D:vetorDados[5],C:vetorDados[6],B:vetorDados[7]};

  // Desenhando teclado inicial
  setTimeout(function(){canvasDraw();},100);
  canvasDraw();
  // Limpa tela
  ctx.clearRect ( 0 , 0 , c.width, c.height );
}

function getCookie(cname) {
    var name = cname + "=";
    var ca = document.cookie.split(';');
    for(var i=0; i<ca.length; i++) {
        var c = ca[i];
        while (c.charAt(0)==' ') c = c.substring(1);
        if (c.indexOf(name) == 0) return c.substring(name.length,c.length);
    }
    return "";
}

function trim(str){
    r = "";
    for(i = 0; i < str.length; i++){
      if(str.charAt(i) != ' ')
        r += str.charAt(i);
   }
  return r;
}


function getAllCookies(month)
{
	var cookies = "";
	for (var i = 1; i < 30; i++)
	{
	    var auxiliar = 1;
		//alert(month+i+"_"+auxiliar);
	    //auxiliar = parseInt(getCookie(month+" "+i+"_0"));//numero de indices de tal dia
		//for (var j = 1; j <= auxiliar+1; j++)
			//cookies = cookies+getCookie(month+" "+i+"_"+j)+"\n";
	    while (getCookie(month+i+"_"+auxiliar) != "")
		{
			cookies = cookies+getCookie(month+i+"_"+auxiliar)+"\n";
			auxiliar++;
		}
	}
    return cookies;		
}


function canvasDrawLine()
{
  ctx.fillStyle = "white";
  ctx.strokeStyle = "white";
  ctx.lineWidth = 1;

  ctx.beginPath();
  ctx.moveTo(c.width*0.37,c.height*0.37);
  ctx.lineTo(size_font_big*2,size_font_big*2);
  ctx.stroke();//< /\

  ctx.beginPath();
  ctx.moveTo(c.width*0.36,c.height*0.5);
  ctx.lineTo(size_font_big*2.23,c.height*0.5);
  ctx.stroke();//<

  ctx.beginPath();
  ctx.moveTo(c.width*0.38,c.height*0.62);
  ctx.lineTo(size_font_big*2,c.height-size_font_big*2);
  ctx.stroke();//< \/

  ctx.beginPath();
  ctx.moveTo(c.width*0.5,c.height*0.67);
  ctx.lineTo(c.width*0.5,c.height-size_font_big*2);
  ctx.stroke();//\/

  ctx.beginPath();
  ctx.moveTo(c.width*0.62,c.height*0.62);
  ctx.lineTo(c.width-size_font_big*2,c.height-size_font_big*2);
  ctx.stroke();//> \/

  ctx.beginPath();
  ctx.moveTo(c.width*0.63,c.height*0.5);
  ctx.lineTo(c.width-size_font_big*2,c.height*0.5);
  ctx.stroke();//>

  ctx.beginPath();
  ctx.moveTo(c.width*0.63,c.height*0.37);
  ctx.lineTo(c.width-size_font_big*2,size_font_big*2);
  ctx.stroke();//> /\

  ctx.beginPath();
  ctx.moveTo(c.width*0.5,c.height*0.36);
  ctx.lineTo(c.width*0.5,size_font_big*2);
  ctx.stroke();// /\
}

function canvasDraw()
{
  // Desenhando linhas
  canvasDrawLine();
  // Desenhando letras em cada ponto da tela
  canvasDrawTeclado(0,"CE");
  canvasDrawTeclado(0,"E");
  canvasDrawTeclado(0,"BE");
  canvasDrawTeclado(0,"CD");
  canvasDrawTeclado(0,"BD");
  canvasDrawTeclado(0,"D");
  canvasDrawTeclado(0,"C");
  canvasDrawTeclado(0,"B");

}

function keyboardTrans(pos) //funcao que retira ou insere o highlight num conjunto de letras
{
      // Inverte teclado principal
      if(pos != "B" && pos != "BE" && pos != "BD")
      {
        // Inverte o valor do gatilho
        posicao[pos].teclado = !posicao[pos].teclado;
        //Trocando os valores de text da posicao desejada
        posicao[pos].text1A = posicao[pos].text2A + (posicao[pos].text2A = posicao[pos].text1A,'');
        posicao[pos].text1B = posicao[pos].text2B + (posicao[pos].text2B = posicao[pos].text1B,'');
        posicao[pos].text1C = posicao[pos].text2C + (posicao[pos].text2C = posicao[pos].text1C,'');
        // Toca o som ao inverter teclado
        document.getElementById('flip').play();
      }
      // Chama a funcao highlight
      highlight(posicao[pos].highlightW,posicao[pos].highlightH,0);
}

function highlight(x,y,limpar)
{
  // Limpa tela
  ctx.clearRect ( 0 , 0 , c.width, c.height );
  // Desenha a seleçao ou limpa
  if (limpar)
  {
    ctx.beginPath()
	  ctx.arc(x,y,c.width*0.1,0,2*Math.PI);
	  ctx.fillStyle = "black";
	  ctx.fill();
  }
  else
  {
    var grd = ctx.createRadialGradient(x,y,c.width*0.001,x,y,c.width*0.5);
    grd.addColorStop(0,"black");
    grd.addColorStop(1,"white");
    ctx.beginPath();
    ctx.arc(x,y,c.width*0.1,0,2*Math.PI);
    ctx.fillStyle = grd;
    ctx.fill();
  }
  // Desenha o teclado novamente
  canvasDraw();
}

function canvasDrawTeclado(controle,pos)
{
  if(!controle)
  {
    //Teclado Primario
    if(pos == "B")
      ctx.font = size_font_big*2+"px betsy2";
    else
      ctx.font = size_font_big+"px Arial";
    ctx.fillText(posicao[pos].text1A,posicao[pos].width1A,posicao[pos].height1A);
    ctx.fillText(posicao[pos].text1B,posicao[pos].width2A,posicao[pos].height2A);
    ctx.fillText(posicao[pos].text1C,posicao[pos].width3A,posicao[pos].height3A);
    //Teclado Secundario
    if(pos == "B")
      ctx.font = size_font_small*2+"px betsy2";
    else
      ctx.font = size_font_small+"px Arial";
    ctx.fillText(posicao[pos].text2A,posicao[pos].width1B,posicao[pos].height1B);
    ctx.fillText(posicao[pos].text2B,posicao[pos].width2B,posicao[pos].height2B);
    ctx.fillText(posicao[pos].text2C,posicao[pos].width3B,posicao[pos].height3B);
    // MINIATURA
    if(pos != "B" && pos != "BD" && pos != "BE")
    {
      minA = posicao[pos].text1A+" ["+posicao[pos].text2A+"]";
      minB = posicao[pos].text1B+" ["+posicao[pos].text2B+"]";
      minC = posicao[pos].text1C+" ["+posicao[pos].text2C+"]";
    }
    else
    {
      minA = posicao[pos].text1A;
      minB = posicao[pos].text1B;
      minC = posicao[pos].text1C;
    }
    ctx.fillText(minA,posicao[pos].width1C,posicao[pos].height1C);
    ctx.fillText(minB,posicao[pos].width2C,posicao[pos].height2C);
    ctx.fillText(minC,posicao[pos].width3C,posicao[pos].height3C);
  }
}
function Coordenadas(objeto)
{
    // Captura as coordenadas do usuario
    x = objeto.clientX;
    y = objeto.clientY;

    var width_part = (c.width / 4);
    var height_part = (c.height / 3);
    var pos = "N";  // posicao padrão
    var comb = ""; // combinação gerada pelo usuario , inicialmente ''
    var aux = 0;  // Indice aux para gerar combinaçao
    var timerAux = 1; // Time event

    // Detectando posicao atual do usuario
    if(x == 0)
        if(y <= height_part )
          pos = "CE"
        else if(y >= (height_part * 2))
          pos = "BE"
        else
          pos = "E"

    if(x == (c.width-1) )
        if(y <= height_part )
          pos = "CD"
        else if(y >= (height_part * 2))
          pos = "BD"
        else
          pos = "D"

    if(y == 0)
       if(x <= width_part)
          pos = "CE"
       else if(x >= (width_part * 3))
          pos = "CD"
       else
          pos = "C"

    if(y >= (c.height-5))
      if(x <= width_part)
          pos = "BE"
       else if(x >= (width_part * 3))
          pos = "BD"
       else
          pos = "B"

    // Armazenando combinação inserida pelo usuario
    if(pos != "N"){
       if(indice == 0)
       {
          combination[indice] = pos;
          highlight(posicao[pos].highlightW,posicao[pos].highlightH,0);
          indice++;
          timerId = setInterval(function(){keyboardTrans(pos);}, 3000);
          timerAux = 1;
          document.getElementById('beep01').play();
       }
       else if(combination[(indice - 1)] != pos)
       {
          combination[indice] = pos;
          indice++;
          document.getElementById('beep02').play();
          clearInterval(timerId);
          timerAux = 0;
       }
    }

    // Checando se usuario retornou ao meio da tela
    if(x >= (c.width*0.4))
       if(x <= (c.width*0.6))
           if(y <= c.height*0.6)
                if(y >= c.height*0.4)
                {
                    while(indice > aux)
                    {
                      comb = comb + combination[aux];
                      aux++
                    }
                    Letra(comb);
                    highlight(posicao[combination[0]].highlightW,posicao[combination[0]].highlightH,1);
    				if(timerAux)
        				clearInterval(timerId);
                    if(posicao[combination[0]].teclado == true)
                    	keyboardTrans(combination[0]);
                    indice = 0;
                    pos = "N";
                }
}


function Letra(pos)
{

    var caractere = ';';
    var length = editor.getLength();
    if(pos != "")
      document.getElementById('beep03').play()

    if(pos == "CE")
		if (!posicao[pos].teclado)
      caractere = 'a';
		else
			caractere = '0';
    if(pos == "CEC")
		if (!posicao["CE"].teclado)
			caractere = 'b';
		else
			caractere = 'z';
    if(pos == "CEE")
		if (!posicao["CE"].teclado)
			caractere = 'c';
		else
			caractere = 'y';

    if(pos == "ECE")
		if (!posicao["E"].teclado)
			caractere = 't';
		else
			caractere = 'k';
    if(pos == "E")
		if (!posicao[pos].teclado)
			caractere = 'u';
		else
			caractere = 'w';
    if(pos == "EBE")
		if (!posicao["E"].teclado)
			caractere = 'v';
		else
			caractere = 'x';

    if(pos == "BEE")
		//if (!posicao["BE"].teclado)
			caractere = 'q';
		//else
			//editor.insertText(length-1, '4',{'color': cores[coresCont],'size':'30px'});
    if(pos == "BE")
		//if (!posicao[pos].teclado)
			caractere = 's';
		//else
			//editor.insertText(length-1, '5',{'color': cores[coresCont],'size':'30px'});
    if(pos == "BEB")
		//if(!posicao["BE"].teclado)
			caractere = 'r';
		//else
			//editor.insertText(length-1, '6',{'color': cores[coresCont],'size':'30px'});

    if(pos == "CDC")
		if(!posicao["CD"].teclado)
			caractere = 'g';
		else
			caractere = '4';
    if(pos == "CD")
		if (!posicao[pos].teclado)
			caractere = 'i';
		else
			caractere = '5';
    if(pos == "CDD")
		if (!posicao["CD"].teclado)
			caractere = 'h';
		else
			caractere = '6';
    if(pos == "DCD")
		if (!posicao["D"].teclado)
			caractere = 'j';
		else
			caractere = '7';
    if(pos == "D")
       if (!posicao[pos].teclado)
			caractere = 'l';
		else
			caractere = '8';
    if(pos == "DBD")
       if (!posicao["D"].teclado)
			caractere = 'm';
		else
			caractere = '9';
    if(pos == "BDD")
       caractere = 'n';
    if(pos == "BDB")
       caractere = 'p';
    if(pos == "BD")
       caractere = 'o';
    if(pos == "CCE")
		if (!posicao["C"].teclado)
			caractere = 'd';
		else
			caractere = '1';
    if(pos == "C")
		if (!posicao[pos].teclado)
			caractere = 'e';
	    else
			caractere = '2';
    if(pos == "CCD")
		if (!posicao["C"].teclado)
			caractere = 'f';
		else
			caractere = '3';
	if(pos == "B")
       caractere = ' ';

    if(pos == "BBD")
    {
       caractere = ". ";
    }
   if(caractere!=';')
    {
    	// Mudando cor do texto
	   if (texto.substring(texto.length-2,texto.length) == ". " || texto[texto.length-1] == '.' || texto == "")
		   caractere = caractere.toUpperCase();
       editor.insertText(length-1,caractere,{'color': cores[coresCont],'size':'30px'});
       texto = texto.concat(caractere);
   	   // Manter sempre a caixa de texto atualizada ( auto scroll )
   	   objeto = document.getElementById('editor');
       objeto.scrollTop = objeto.scrollHeight;
    	if(caractere == ". ")
	       	if(coresCont == 0)
    	   		coresCont = 1;
       		else
       			coresCont = 0;
    }
    if(pos == "BBE")
    {
       var lastChar = editor.getText(length-2,length-1);
       // Verifica se um ponto foi removido e muda a cor no caso positivo
       if(lastChar == '.')
       	   if(coresCont == 0)
       	   		coresCont = 1;
       	   	else
       	   		coresCont = 0;
       editor.deleteText(length-2,length);
       texto = texto.substring(0,texto.length-1);
    }
}

</script>
<style>
body {position:fixed;width:100%; height:100%; overflow:hidden, margin:0}
html {width:100%; height:100%; overflow:hidden}

@font-face {
   font-family: "betsy2";
    /* IE */
    src: url('./fonts/BETSY2.eot');
    /* IE */

    /* Not IE */
    src: local("betsy2ttf"), url('./fonts/BETSY2.ttf');
    format("truetype");
    /* Not IE */
}
</style>
</head>
<body  style="margin:0px" onLoad="inicio()">

<div id="coordiv" style="width:100%;height:100%;border:1px solid;z-index:1" onmousemove="Coordenadas(event)">
<canvas id="myCanvas" style="border:1px; background-color:black"></canvas>
<div id="editor" style="position: absolute; left:40%;top:40%; width:20%; height: 20%;border:2px solid white"></div>
</div>
</body>
</html>
